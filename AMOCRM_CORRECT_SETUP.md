# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –≤ amoCRM

## –ü—Ä–æ–±–ª–µ–º–∞
–í amoCRM **–Ω–µ—Ç –ø–æ–ª–µ–π —Ç–∏–ø–∞ "–∫–Ω–æ–ø–∫–∞" –∏–ª–∏ "—Å—Å—ã–ª–∫–∞"**. –í–∏–¥–∂–µ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

## –†–µ—à–µ–Ω–∏–µ: –î–≤–∞ —Ä–∞–±–æ—á–∏—Ö —Å–ø–æ—Å–æ–±–∞

---

## üéØ –°–ø–æ—Å–æ–± 1: –í–∏–¥–∂–µ—Ç —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–∂–µ—Ç –≤ –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–¥–µ–ª–∫–∏.

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤–∏–¥–∂–µ—Ç–∞

–§–∞–π–ª—ã —É–∂–µ –≥–æ—Ç–æ–≤—ã –≤ `public/amocrm-widget/`:
- `manifest.json` ‚Äî –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤–∏–¥–∂–µ—Ç–∞
- `script.js` ‚Äî –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞  
- `style.css` ‚Äî —Å—Ç–∏–ª–∏
- `i18n/ru.json` ‚Äî –ø–µ—Ä–µ–≤–æ–¥—ã

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞ HTTPS-—Ö–æ—Å—Ç–∏–Ω–≥

–§–∞–π–ª—ã –≤–∏–¥–∂–µ—Ç–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ HTTPS. –ï—Å—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–µ–º –¥–æ–º–µ–Ω–µ**
```
https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/manifest.json
https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/script.js
https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/style.css
https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/i18n/ru.json
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDN**
- GitHub Pages
- CloudFlare Pages
- Netlify
- Vercel

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ amoCRM

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**

2. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä`
   - –û–ø–∏—Å–∞–Ω–∏–µ: `–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–¥–µ–ª–∫–∏`
   - Redirect URI: `https://functions.poehali.dev/1ef24008-864d-4313-add9-5085c0faed3b`
   - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Å–¥–µ–ª–æ–∫, –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

3. **–ü–æ–ª—É—á–∏—Ç–µ Client ID –∏ Client Secret**

### –®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–í–∏–¥–∂–µ—Ç—ã"**
2. **–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–∂–µ—Ç"**
3. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä`
   - –ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞: `calculator`
   - –ü—É—Ç—å –∫ manifest.json: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/manifest.json`
   - –ü—É—Ç—å –∫ script.js: `https://–≤–∞—à-–¥–æ–º–µ–Ω.com/amocrm-widget/script.js`
   
4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ**

### –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
2. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. –ù–∞–∂–º–∏—Ç–µ **"–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"**
4. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏–¥–∂–µ—Ç –¥–ª—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–¥–µ–ª–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å–¥–µ–ª–∫—É
2. –°–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É –Ω–∞–∂–º–∏—Ç–µ **"–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É"** (–∏–∫–æ–Ω–∫–∞ —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–∏)
3. –í —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞–π–¥–∏—Ç–µ **"–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"**
4. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ–≥–æ –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –ø—Ä–∞–≤–æ–π –∫–æ–ª–æ–Ω–∫–∏
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –≤–∏–¥–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ —Å–ø—Ä–∞–≤–∞! ‚úÖ

---

## üîß –°–ø–æ—Å–æ–± 2: –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å iframe (–ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å, –ø–æ–∫–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –≤–∏–¥–∂–µ—Ç:

### –ß–µ—Ä–µ–∑ API –∏–ª–∏ —Ä—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ

–í –∫–∞–∂–¥—É—é —Å–¥–µ–ª–∫—É –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ —Å —Ç–∞–∫–∏–º –∫–æ–¥–æ–º:

```html
<iframe 
  src="https://–≤–∞—à-–¥–æ–º–µ–Ω.com/widget" 
  width="100%" 
  height="800" 
  frameborder="0"
  style="border: 1px solid #e5e5e5; border-radius: 8px; min-height: 800px;"
></iframe>
```

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–∞–∂–¥—É—é —Å–¥–µ–ª–∫—É –≤—Ä—É—á–Ω—É—é
- ‚ùå –ù–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å amoCRM
- ‚ùå –ù–µ–ª—å–∑—è –ø–µ—Ä–µ–¥–∞—Ç—å ID —Å–¥–µ–ª–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üìã –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ manifest.json

```json
{
  "widget": {
    "name": "widget.calculator",
    "description": "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏",
    "short_description": "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
    "version": "1.0.0",
    "init_once": false,
    "locale": ["ru"],
    "is_crm": true
  },
  "locations": [
    "lcard"
  ],
  "settings": []
}
```

**locations** ‚Äî –≥–¥–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç:
- `lcard` ‚Äî –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–¥–µ–ª–∫–∏ ‚úÖ
- `ccard` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- `comcard` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- `cucard` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

---

## üìù –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ script.js

```javascript
define(['jquery'], function($) {
  var CustomWidget = function() {
    this.callbacks = {
      render: function() {
        return true;
      },
      init: function() {
        return true;
      },
      bind_actions: function() {
        var widget = this;
        
        // –ü–æ–ª—É—á–∏—Ç—å ID —Å–¥–µ–ª–∫–∏
        var leadId = this.system().area.id;
        var domain = this.system().subdomain;
        
        // –°–æ–∑–¥–∞—Ç—å iframe
        var widgetUrl = 'https://–≤–∞—à-–¥–æ–º–µ–Ω.com/widget?lead_id=' + leadId + '&domain=' + domain;
        
        var $iframe = $('<iframe>', {
          src: widgetUrl,
          width: '100%',
          height: '800',
          frameborder: '0',
          style: 'border: none; min-height: 800px;'
        });
        
        // –î–æ–±–∞–≤–∏—Ç—å –≤ –≤–∏–¥–∂–µ—Ç
        $('.widget-' + this.get_settings().widget_code).append($iframe);
        
        return true;
      }
    };
    return this;
  };
  
  return CustomWidget;
});
```

---

## üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: SalesBot + Webhook

–ï—Å–ª–∏ –≤–∏–¥–∂–µ—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SalesBot:

1. **–°–æ–∑–¥–∞–π—Ç–µ SalesBot –≤ amoCRM**
2. **–î–æ–±–∞–≤—å—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä**: "–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–¥–µ–ª–∫–∏"
3. **–î–æ–±–∞–≤—å—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ**: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
4. **–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
[–û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä](https://–≤–∞—à-–¥–æ–º–µ–Ω.com/widget?lead_id={{lead.id}})
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–¥–µ–ª–∫–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä!

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. CORS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω
–í –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
```
Access-Control-Allow-Origin: *.amocrm.ru
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
```

### 2. –í–∏–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ HTTPS
amoCRM –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–∂–µ—Ç—ã —Å HTTP!

### 3. –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã
manifest.json, script.js, style.css –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### 4. –ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AMD —Ñ–æ—Ä–º–∞—Ç
```javascript
define(['jquery'], function($) {
  // –∫–æ–¥ –≤–∏–¥–∂–µ—Ç–∞
});
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):

**‚ùå "Failed to load manifest.json"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏

**‚ùå "Widget is not defined"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç script.js (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å AMD)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `define(['jquery'], ...)`

**‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞—Ä—Ç–æ—á–∫–µ**
- –ó–∞–π–¥–∏—Ç–µ –≤ "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É" –≤ —Å–¥–µ–ª–∫–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤–∏–¥–∂–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)

**‚ùå "CORS Error"**
- –î–æ–±–∞–≤—å—Ç–µ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ–º–µ–Ω *.amocrm.ru

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–∏–¥–∂–µ—Ç–∞–º amoCRM](https://www.amocrm.ru/developers/content/crm_platform/widgets)
- [–ü—Ä–∏–º–µ—Ä—ã –≤–∏–¥–∂–µ—Ç–æ–≤ –Ω–∞ GitHub](https://github.com/amocrm)
- [–ù–∞—à–µ community](https://t.me/+QgiLIa1gFRY4Y2Iy)

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç

- [ ] –§–∞–π–ª—ã –≤–∏–¥–∂–µ—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞ HTTPS-—Ö–æ—Å—Ç–∏–Ω–≥
- [ ] manifest.json –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ
- [ ] script.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AMD —Ñ–æ—Ä–º–∞—Ç —Å define()
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ amoCRM
- [ ] Client ID –∏ Client Secret –ø–æ–ª—É—á–µ–Ω—ã
- [ ] –í–∏–¥–∂–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
- [ ] –í–∏–¥–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∞–∫–∫–∞—É–Ω—Ç–µ
- [ ] –í–∏–¥–∂–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å"
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è *.amocrm.ru
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–¥–µ–ª–∫–µ

–£—Å–ø–µ—à–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏! üöÄ
